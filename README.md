## dunhill_toarcian
Code to Reproduce Dunhill et al analysis of secondary extinctions in Toarcian food webs, submitted to Nature Ecology and Evolution for review.

The project assumes the user has R and RStudio installed.

To initiate the project, after cloning/downloading the file containing the Scripts and Data and project file, the user should double click the project file `dunhill_toarcian.Rproj`.

Details for each file are provided below.  

The reader/replicator/referee can start with network generation, scenario modelling or plotting/analysis.  The data from each of those steps is provided and the use of `read_csv()` or `load()` data is embedded in each stage to acquire the previous stages data.


### Data Files

    - ToarcianWebs_Guild_May2021.RData - core input data of Toarcian Network
    - wrkWebs_allSeqs.RData - output from GenerateExintctionSequences (can be recreated with set.seed()) and used (loaded) in AnalyseToarcianNetworks.
    - metrics_time2.csv - details among times slices on network metrics
    - metrics_time.csv - details among times slices on network metrics
    - feeding_rules.csv - input constraints on feeding for pfim model
    - robustnessMeans_500_0.5spread.RData - secondary extinction simulation output

### Food Web Generation, Scenario Generation, Scenario Modelling, Robustness

1. `pfim.R` - This file contains the functions necessary to construct food webs using Shaw et al (https://www.biorxiv.org/content/10.1101/2024.01.30.578036v1) method described in the MS.  It also contains bespoke functions to calculate several metrics and motifs.  This is a self contained subset of the PFIM code base and does not require the package in that pre-print.  The `infer_edgelist()` function in this script file does the primary work, and calls the `feeding_rules.csv` file alongside the input data.
2. `GenerateExtinctionSequences.R` is the primary tool to generate the secondary extinction scenarios from the networks.  The code - 
    - defines traits; 
    - defines the scenarios based on stratfied samples of traits from the reference network; 
    - contains the function to implement secondary extinction cascades, via primary extinctions scenarios, using the R package `cheddar`'s function `RemoveNodes()`; 
    - collects and stores the simulated networks and extinction sequences.
    - used to produce Fig2a-d.
3. `robustness_gradient.R` - function to calculate robustness following generalised method from Jonsson et al Oikos 124: 446â€“457, 2015 (Produces Fig 3.)

### Visualisation of networks in 3D

1. `plot_3d_foodwebs_orig.R` - Shaw et al - Fig 1 (https://www.biorxiv.org/content/10.1101/2024.01.30.578036v1) functions to plot food webs in 3D. 

### Analysis of secondary exinction scenarios - Produces Figure 2a,b.

1.`Fig2_ab_AnalyseToarcianNetworks_upadate4Publication.R` - estimates several structural metrics, motifs and True Skill Statistic from secondary extinction scenarios and the outcome networks.  

### Analysis of network structure through time - Produces Figure 2c,d.

1.`Fig2_cd_guild network metric plotting_upadate4Publication.R` accesses combined data generated by `GuildWebsBuildPlotAnalyse.R` in Reference-Scratch

### Make Composite Fig 2a-d

1.`Fig2_MakeCompositeFigure.R` - uses patchwork in R to combine figures and create Fig 2a-d from 2ab and 2cd above.

### Robustness Evaluation - Fig 3

1.`Fig3_SecondaryExtinctionAssess.R` - uses saved data to produce Fig 3.  Code to produce data included, but commented out.